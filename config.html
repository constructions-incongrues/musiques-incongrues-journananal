<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Zeitgeist</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            color: #1a1a1a;
            line-height: 1.6;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #e600e6;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background: #e600e6;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        button:hover {
            background: #d100d1;
        }

        .description {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #e600e6;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Configuration Zeitgeist</h1>

        <div class="description">
            <p>Configurez les paramètres pour générer une page Zeitgeist personnalisée.</p>
        </div>

        <form id="configForm" onsubmit="return redirectToZeitgeist(event)">
            <div class="form-group">
                <label for="titre">Titre de la page:</label>
                <input type="text" id="titre" name="titre" value="Zeitgeist - Musiques Incongrues" required>
            </div>

            <div class="form-group">
                <label for="base_date">Date de base:</label>
                <input type="date" id="base_date" name="base_date" required>
            </div>

            <div class="form-group">
                <label for="num">Nombre de périodes:</label>
                <input type="number" id="num" name="num" value="1" min="1" max="52" required>
            </div>

            <div class="form-group">
                <label for="unit">Unité de temps:</label>
                <select id="unit" name="unit" required>
                    <option value="days">Jours</option>
                    <option value="weeks" selected>Semaines</option>
                    <option value="months">Mois</option>
                </select>
            </div>

            <div class="form-group">
                <label for="limit">Limite d'éléments:</label>
                <input type="number" id="limit" name="limit" value="50" min="1" max="200" required>
            </div>

            <div class="form-group">
                <label for="collection_labels">Collection pour Labels:</label>
                <select id="collection_labels" name="collection_labels" required>
                    <option value="gargamelle" selected>gargamelle</option>
                    <option value="discutons">discutons</option>
                    <option value="sonsoftheananas">sonsoftheananas</option>
                    <option value="millemilliards">millemilliards</option>
                    <option value="amour">amour</option>
                </select>
            </div>

            <div class="form-group">
                <label for="collection_radios">Collection pour Radios:</label>
                <select id="collection_radios" name="collection_radios" required>
                    <option value="gargamelle">gargamelle</option>
                    <option value="discutons" selected>discutons</option>
                    <option value="sonsoftheananas">sonsoftheananas</option>
                    <option value="millemilliards">millemilliards</option>
                    <option value="amour">amour</option>
                </select>
            </div>

            <div class="form-group">
                <label for="collection_artists">Collection pour Artistes:</label>
                <select id="collection_artists" name="collection_artists" required>
                    <option value="gargamelle">gargamelle</option>
                    <option value="discutons">discutons</option>
                    <option value="sonsoftheananas" selected>sonsoftheananas</option>
                    <option value="millemilliards">millemilliards</option>
                    <option value="amour">amour</option>
                </select>
            </div>

            <div class="form-group">
                <label for="collection_contributors">Collection pour Contributeurs:</label>
                <select id="collection_contributors" name="collection_contributors" required>
                    <option value="gargamelle">gargamelle</option>
                    <option value="discutons">discutons</option>
                    <option value="sonsoftheananas">sonsoftheananas</option>
                    <option value="millemilliards" selected>millemilliards</option>
                    <option value="amour">amour</option>
                </select>
            </div>

            <div class="form-group">
                <label for="collection_newcomers">Collection pour Nouveaux:</label>
                <select id="collection_newcomers" name="collection_newcomers" required>
                    <option value="gargamelle">gargamelle</option>
                    <option value="discutons">discutons</option>
                    <option value="sonsoftheananas">sonsoftheananas</option>
                    <option value="millemilliards">millemilliards</option>
                    <option value="amour" selected>amour</option>
                </select>
            </div>

            <button type="submit">Générer la page Zeitgeist</button>
        </form>
    </div>

    <script>
        // Charger la liste des collections
        async function loadCollections() {
            try {
                const response = await fetch('https://emo.musiques-incongrues.net/collections.json');
                const collections = await response.json();

                // Liste des IDs des selects de collection
                const collectionSelectIds = [
                    'collection_labels',
                    'collection_radios',
                    'collection_artists',
                    'collection_contributors',
                    'collection_newcomers'
                ];

                // Collections par défaut pour chaque select
                const defaultCollections = {
                    collection_labels: 'gargamelle',
                    collection_radios: 'discutons',
                    collection_artists: 'sonsoftheananas',
                    collection_contributors: 'millemilliards',
                    collection_newcomers: 'amour'
                };

                collectionSelectIds.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    select.innerHTML = ''; // Vider les options existantes

                    // Obtenir la liste des noms de collections
                    let collectionNames = [];
                    if (Array.isArray(collections)) {
                        collectionNames = collections;
                    } else if (typeof collections === 'object') {
                        collectionNames = Object.values(collections);
                    }

                    // Trier les collections par nom
                    const sortedCollections = collectionNames.sort();

                    sortedCollections.forEach(collectionName => {
                        const option = document.createElement('option');
                        option.value = collectionName;
                        option.textContent = collectionName;

                        // Sélectionner la collection par défaut
                        if (collectionName === defaultCollections[selectId]) {
                            option.selected = true;
                        }

                        select.appendChild(option);
                    });
                });

            } catch (error) {
                console.error('Erreur lors du chargement des collections:', error);
            }
        }

        // Définir la date d'aujourd'hui par défaut
        function setDefaultDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${yyyy}-${mm}-${dd}`;

            document.getElementById('base_date').value = formattedDate;
        }

        // Pré-remplir le formulaire avec les paramètres URL
        function prefillForm() {
            const params = new URLSearchParams(window.location.search);

            // Pré-remplir les champs avec les valeurs des paramètres
            const fields = ['titre', 'base_date', 'num', 'unit', 'limit', 'collection_labels', 'collection_radios', 'collection_artists', 'collection_contributors', 'collection_newcomers'];

            fields.forEach(field => {
                const value = params.get(field);
                if (value && document.getElementById(field)) {
                    document.getElementById(field).value = value;
                }
            });
        }

        // Rediriger vers la page Zeitgeist avec les paramètres
        function redirectToZeitgeist(event) {
            event.preventDefault();

            const params = new URLSearchParams();
            params.set('titre', document.getElementById('titre').value);
            params.set('base_date', document.getElementById('base_date').value);
            params.set('num', document.getElementById('num').value);
            params.set('unit', document.getElementById('unit').value);
            params.set('limit', document.getElementById('limit').value);
            params.set('collection_labels', document.getElementById('collection_labels').value);
            params.set('collection_radios', document.getElementById('collection_radios').value);
            params.set('collection_artists', document.getElementById('collection_artists').value);
            params.set('collection_contributors', document.getElementById('collection_contributors').value);
            params.set('collection_newcomers', document.getElementById('collection_newcomers').value);

            // Construire l'URL absolue basée sur l'emplacement actuel
            const baseUrl = window.location.href.replace(/config\.html.*$/, '');
            const zeitgeistUrl = baseUrl + 'index.html?' + params.toString();

            window.location.href = zeitgeistUrl;
            return false;
        }

        // Charger les collections au chargement de la page
        loadCollections();
        setDefaultDate();
        prefillForm();
    </script>
</body>
</html>
